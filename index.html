<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gradient Descent Visualization</title>
    <!-- Load Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <!-- Load MathJax for LaTeX rendering -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        /* Overall page styling */
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: #ffffff; /* White for background outside the box */
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
            background-color: #f2f1ef; /* Light warm grey inside the container */
            border-radius: 8px;
            margin-top: 40px;
            text-align: center; /* Center content inside the container */
        }

        /* Center the plot */
        #plot {
            display: block;
            margin: 0 auto;
            width: 100%;
        }

        /* Responsive styling */
        @media (max-width: 600px) {
            .container {
                padding: 20px 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="plot"></div>
    </div>

    <script>
        // Gradient function
        function gradient(x) {
            return 2 * x; // Derivative of f(x) = x^2
        }

        // Function to animate gradient descent
        function plotGradientDescent() {
            let xValues = [];
            let yValues = [];
            let pathX = [];
            let pathY = [];

            // Generate x values for the function f(x) = x^2
            for (let i = -10; i <= 10; i += 0.1) {
                xValues.push(i);
                yValues.push(i * i);  // f(x) = x^2
            }

            // Gradient Descent with fixed learning rate of 0.1
            let x = 4;  // Starting point x = 4
            const learningRate = 0.1;

            // Initial point (x = 4)
            pathX.push(x);
            pathY.push(x * x);

            // First step of gradient descent (x = 4 -> x = 3.2)
            let x1 = x - learningRate * gradient(x); 
            pathX.push(x1);
            pathY.push(x1 * x1);

            // Second step of gradient descent (x = 3.2 -> x = 2.56)
            let x2 = x1 - learningRate * gradient(x1); 
            pathX.push(x2);
            pathY.push(x2 * x2);

            // Plot the function
            const functionPlot = {
                x: xValues,
                y: yValues,
                mode: 'lines',
                line: { color: '#2980b9', width: 5 },
                name: 'f(x) = x^2',
                hoverinfo: 'none'  // Disable hover info for this trace
            };

            // Plot the initial point at x = 4
            const initialPointPlot = {
                x: [pathX[0]],
                y: [pathY[0]],
                mode: 'markers',
                marker: { color: '#e74c3c', size: 12 },
                name: 'Gradient Descent Start',
                hoverinfo: 'none'  // Disable hover info for this trace
            };

            // Plot the second static point at x = 3.2
            const secondStaticPointPlot = {
                x: [pathX[1]],
                y: [pathY[1]],
                mode: 'markers',
                marker: { color: '#e74c3c', size: 12 },
                name: 'Second Point',
                hoverinfo: 'none'  // Disable hover info for this trace
            };

            // Plot the point that animates from x = 3.2 to x = 2.56
            const animatedPointPlot = {
                x: [pathX[1]],  // Start at x = 3.2
                y: [pathY[1]],
                mode: 'markers',
                marker: { color: '#f1c40f', size: 12 },
                name: 'Moving Point',
                hoverinfo: 'none'  // Disable hover info for this trace
            };

            const layout = {
                autosize: true, // Ensure the chart resizes to the iframe
                xaxis: {
                    title: 'x',
                    titlefont: { size: 18, color: '#34495e' },
                    linewidth: 2, // Thicker axis lines
                    fixedrange: true
                },
                yaxis: {
                    title: 'f(x)',
                    titlefont: { size: 18, color: '#34495e' },
                    linewidth: 2, // Thicker axis lines
                    fixedrange: true
                },
                plot_bgcolor: '#ecf0f1',
                paper_bgcolor: '#f2f1ef', /* Light warm grey inside the plot as well */
                showlegend: false, // Hide the legend
                margin: { l: 70, r: 70, b: 70, t: 50 }, // Adjusted margins to avoid cutting
                height: 500,  // Adjust height to fit iframe better
                hovermode: false  // Disable hover mode globally
            };

            const config = {
                displayModeBar: false  // Hide the Plotly toolbar
            };

            // Initial plot with three points (initial, second static, and moving point)
            Plotly.newPlot('plot', [functionPlot, initialPointPlot, secondStaticPointPlot, animatedPointPlot], layout, config);

            // Function to animate the moving point (x = 3.2 -> x = 2.56)
            function animatePoint() {
                Plotly.animate('plot', {
                    data: [{ x: [pathX[2]], y: [pathY[2]] }],
                    traces: [3],
                    layout: {}
                }, {
                    transition: {
                        duration: 1000,
                        easing: 'cubic-in-out'
                    },
                    frame: {
                        duration: 1000
                    }
                }).then(() => {
                    // After the move, reset the point back to x = 3.2 and repeat the loop
                    setTimeout(() => {
                        Plotly.animate('plot', {
                            data: [{ x: [pathX[1]], y: [pathY[1]] }],
                            traces: [3],
                            layout: {}
                        }, {
                            transition: {
                                duration: 0, // Instant reset to start
                            },
                            frame: {
                                duration: 0
                            }
                        });
                        animatePoint(); // Repeat the loop
                    }, 500); // Short pause before restarting the animation
                });
            }

            // Start the animation loop
            animatePoint();
        }

        // Ensure the plot renders fully centered on initial load
        window.onload = function() {
            setTimeout(() => {
                plotGradientDescent();
                MathJax.typeset();  // Rerender LaTeX equations
            }, 100);  // Add a slight delay to ensure container sizes are calculated correctly
        };
    </script>
</body>
</html>
